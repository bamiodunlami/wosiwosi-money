try{let e,a,t,n,c,o,r,s,d;$("#rec-bar").hide(),$("#pay-option").hide(),$("#summary").hide(),$("#card-msg").hide(),$("#addrec-bar").show(),$("#card-details-bar").show();let l=$("#send-amount"),i=$("#take-amount");fetch("/loadbank",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.text())).then((e=>{try{let a=JSON.parse(e),t=document.querySelector("#bankName");for(let e=0;e<a.length;e++){let n=`<option value="${a[e].code}"> ${a[e].name}</option>`;t.innerHTML+=n}}catch(e){}})),$("#btn-confirm").on("click",(()=>{$("#account-msg").text("Confirming..."),$("#account-msg").addClass("alert alert-light"),$("#account-msg").show();let e={accountNumber:$("#accountNumber").val(),bankCode:$("#bankName option:selected").val()};fetch("/confirm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.text())).then((e=>{lookupResult=JSON.parse(e),"success"==JSON.parse(e).status?($("#account-msg").text(lookupResult.data.account_name),$("#account-msg").removeClass("alert-light"),$("#account-msg").removeClass("alert-danger"),$("#account-msg").addClass("alert alert-success"),$("#account-msg").show(),$("#btn-addAccount").prop("disabled",!1)):($("#account-msg").text("Invalid Account Details"),$("#account-msg").removeClass("alert-light"),$("#account-msg").removeClass("alert-success"),$("#account-msg").addClass("alert alert-danger"),$("#account-msg").show())}))})),$("#btn-addAccount").on("click",(e=>{e.preventDefault();let a={acctNumber:$("#accountNumber").val(),acctName:$("#account-msg").text(),bankName:$("#bankName option:selected").val(),bankRealName:$("#bankName option:selected").html()};fetch("/addReceiver",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json())).then((e=>{1==e.acknowledged&&window.location.reload()}))}));let m=$("#expiry-date");$(m).on("keyup",(()=>{if(2==m.val().length){let e=m.val();m.val(e+"/")}})),$("#btn-addCard").on("click",(e=>{e.preventDefault();let a={cardName:$("#nameOnCard").val(),cardNumber:$("#cc-number").val(),expDate:$("#expiry-date").val(),cvv:$("#cvv").val()};fetch("/addCard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.text())).then((e=>{"false"==e?($("#card-msg").show(),$("#card-msg").text("Card Details incorrect")):window.location.reload()}))})),fetch("/rate",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.text())).then((r=>{function s(){switch(t){case"GBPtoNGN":n=r.GBPTONGN,c=l.val(),o=c*n,i.val(o.toFixed(2)),$("#rateValue").text(`NGN ${n}`),d();break;case"GBPtoGHS":n=r.GBPTOGHS,c=l.val(),o=c*n,i.val(o),$("#rateValue").text(`GHS ${n}`),d();break;case"GBPtoKEN":n=r.GBPTOKEN,c=l.val(),o=c*n,i.val(o),d()}}function d(){l.val()>1500?($("#btn-send").css("background-color","#8b8b8b"),$("#btn-send").prop("disabled",!0),$("#sendMessage").removeClass("showSendMessage")):l.val()>9.99?($("#btn-send").css("background-color","#009933"),$("#btn-send").prop("disabled",!1),$("#sendMessage").addClass("showSendMessage")):l.val()<=9.99&&($("#btn-send").css("background-color","#8b8b8b"),$("#btn-send").prop("disabled",!0),$("#sendMessage").addClass("showSendMessage"))}r=JSON.parse(r),$("#rateValue").text(`NGN ${r.GBPTONGN}`),$("#sendCurrency").on("change",(()=>{e=$("#sendCurrency").val(),a=$("#takeCurrency").val(),$("#baseFlag").attr("src",`https://flagcdn.com/${e.slice(0,2).toLowerCase()}.svg`),t=`${e}to${a}`,s()})),l.on("keyup",(()=>{e=$("#sendCurrency").val(),a=$("#takeCurrency").val(),t=`${e}to${a}`,s()})),$("#takeCurrency").on("change",(()=>{e=$("#sendCurrency").val(),a=$("#takeCurrency").val(),$("#takeFlag").attr("src",`https://flagcdn.com/${a.slice(0,2).toLowerCase()}.svg`),t=`${e}to${a}`,s()})),i.on("keyup",(()=>{e=$("#sendCurrency").val(),a=$("#takeCurrency").val(),t=`${e}to${a}`,s()}))})),$("#btn-send").on("click",(()=>{$("#exchange-bar").hide(),$("#tran").hide(),$("#rec-bar").show()})),$("#back").on("click",(()=>{$("#exchange-bar").show(),$("#tran").show(),$("#rec-bar").hide(),$("#pay-option").hide()}));let u=$(".receiver");for(let e=0;e<u.length;e++){let a=$(".acctName"),t=$(".acctNumber"),n=$(".bank"),c=$(".bankCode");$(u[e]).on("click",(()=>{s={accountName:$(a[e]).text(),accountNumber:$(t[e]).text(),bank:$(n[e]).text(),bankCode:$(c[e]).val()},$("#rec-bar").hide(),$("#pay-option").show()}))}$("#back-again").on("click",(()=>{$("#rec-bar").show(),$("#pay-option").hide()}));let b=$(".paymentOption");for(let t=0;t<b.length;t++){let n=$(".cardName"),l=$(".cardNumber");$(b[t]).on("click",(()=>{d={cardName:$(n[t]).text(),cardEndingNumber:$(l[t]).text()},r=Number($("#storedPromoCode").val()),o=Number(o+r),$("#pay-option").hide(),$("#summary").show(),$(".sendAmount").text(`${e} ${c}`),$(".takeAmount").text(`${a} ${o.toFixed(2)}`),$(".promoValue").text(r),$(".cAcctName").text(s.accountName),$(".cAcctNumber").text(s.accountNumber),$(".cBank").text(s.bank),$(".cCardName").text(d.cardName),$(".cCardNumber").text(d.cardEndingNumber)}))}$("#back-again").on("click",(()=>{$("#rec-bar").show(),$("#pay-option").hide()})),$("#back-last").on("click",(()=>{$("#summary").hide(),$("#pay-option").show()})),$("#send-money").on("click",(()=>{$("#send-money").prop("disabled",!0),$("#rec-bar").prop("disabled",!0),$("#send-money").text("process...");let l=String(4*Math.random()).slice(2);exchangeValues={currencyPair:t,sendCurrency:e,takeCurrency:a,sendAmount:100*c,takeAmount:o,promo:r,Base:n,receiverName:s.accountName,accountNumber:s.accountNumber,bankName:s.bank,bankCode:s.bankCode,nameOnPaymentCard:d.cardName,cardEnding:d.cardEndingNumber,ref:`w0s${l}`};let i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(exchangeValues)};fetch("/exchange",i).then((e=>e.json())).then((e=>{0==e?window.location.href="/fail":1==e&&(window.location.href="/success")}))}))}catch(e){}